version: "3.17"

tasks:

    dist:
        desc: Builds and then allows for publishing
        deps: [build]
        cmds:
            - uv publish

    build:
        desc: Builds distributable tar.gz and wheel files using docker
        cmds:
            - task: check
            - docker build -t effectual .
            - docker create --name effectual effectual
            - docker start effectual
            - docker cp effectual:effectual/dist/ .
            - docker stop effectual
            - docker rm effectual

    check:
        desc: Formats and lints python source files
        deps: [lint, format]

    format:
        desc: Formats python source files
        cmds:
            - uv run ruff format --config pyproject.toml

    lint:
        desc: Lints python source files
        cmds:
            - uv run ruff check --config pyproject.toml
            
    
    type:
        desc: Type checks python source files
        cmds:
            - uv run mypy src/effectual/*.py
    
    setup:
        desc: Installs dependencies and creates venv
        cmds:
            - uv python install 3.11
            - uv venv --python 3.11
            - uv lock
            - uv sync
